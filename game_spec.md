# Stellar Gunners（ステラガンナーズ） ゲーム仕様書

## 1. プロジェクト概要

### 基本情報
- **タイトル**: Stellar Gunners（ステラガンナーズ）
- **ジャンル**: 2D見下ろし弾幕シューティングRPG
- **参考ゲーム**: ガール・カフェ・ガン（バトル・装備・強化システム）
- **プラットフォーム**: Webブラウザ（PC/モバイル）
- **技術スタック**: Phaser 3.x（CDN）、JavaScript（ES6+）、localStorage
- **1ステージ所要時間**: 2〜5分
- **視点**: トップダウン（見下ろし型）

### コンセプト
近未来、「虚晶体」と呼ばれる異形の敵が世界を侵食する中、特殊戦闘部隊「ステラ」に所属する少女たちが銃火器で戦う2D弾幕シューティングRPG。3人パーティ編成で弾幕を避けながら射撃し、装備・モジュール・キャラ強化によって戦力を高めていく。

### ガールカフェガンから継承するシステム
| 要素 | 継承内容 | 2D化での変更点 |
|------|---------|---------------|
| **バトル** | 3人パーティ弾幕STG、シールド＋HP二重耐久、ブレイクゲージ | クォータービュー→トップダウン |
| **属性** | 5属性相性（3すくみ+相互弱点） | そのまま |
| **キャラタイプ** | 火力/補助/防御/医療/強襲の5タイプ | そのまま |
| **武器種** | 5種類の銃器 | そのまま |
| **武器装備** | メイン属性＋サブ属性、武器スキル | そのまま |
| **武器改造** | 部品4スロット、サブ属性厳選 | そのまま |
| **モジュール** | 4種モジュール（ATK/DEF/HP/Shield）、付加属性 | そのまま |
| **キャラ強化** | レベル、限界突破、覚醒、シンクロ | そのまま |
| **編成** | メイン3人＋サブキャラ枠＋モジュール枠 | そのまま |
| **ステージ** | チャプター制、スタミナ消費、星評価 | そのまま |
| **カフェ要素** | ❌ 除外 | 拠点はシンプルなメニューUIに |

### 除外する要素
- カフェ経営（箱庭シミュレーション）
- 好感度・コミュニケーション（メッセ、メール、ボード）
- Live2Dキャラ表示
- ガチャ（ステージドロップ＋ショップ購入に変更）
- マルチプレイ（連携出撃）

---

## 2. キャラクター設計

### 2-1. オリジナルキャラクター一覧（MVP: 6名）

| ID | 名前 | コードネーム | 初期属性 | 初期タイプ | 初期武器種 | 外見イメージ | レア度 |
|----|------|------------|---------|----------|----------|------------|--------|
| chr_01 | レイナ・ヴォルト | Volt | 生体(赤) | 火力 | アサルトライフル | 銀髪ショートカット、赤いジャケット、活発 | ★3 |
| chr_02 | セレナ・リーフ | Leaf | 霊脳(緑) | 医療 | ピストル | 緑髪ロング、白衣、穏やかな雰囲気 | ★3 |
| chr_03 | カイラ・アーク | Arc | 機械(青) | 防御 | ショットガン | 青髪ポニーテール、ゴーグル、メカ好き | ★3 |
| chr_04 | ノワール・シェイド | Shade | 侵蝕(紫) | 強襲 | スナイパーライフル | 黒髪ロング、ダークコート、クール | ★4 |
| chr_05 | リリス・ブレイズ | Blaze | 防疫(黄) | 補助 | ランチャー | 金髪ツインテール、明るい軍服、元気 | ★4 |
| chr_06 | ミラ・フロスト | Frost | 機械(青) | 火力 | スナイパーライフル | 水色ボブカット、ラボコート、天才肌 | ★3 |

### 2-2. キャラカードシステム

同一キャラクターが衣装違い（カード違い）で属性・タイプ・武器種が変わる。

```
例: レイナ・ヴォルト
├─ [★3 通常・レイナ]    属性:生体  タイプ:火力  武器:アサルトライフル
├─ [★4 戦術・レイナ]    属性:機械  タイプ:強襲  武器:ショットガン
└─ [★4 儀礼・レイナ]    属性:防疫  タイプ:補助  武器:ピストル
```

**MVP時点ではカード1枚/キャラ。拡張で追加。**

### 2-3. キャラステータス

| ステータス | 説明 | 初期値目安(★3 Lv1) |
|----------|------|-------------------|
| HP | 体力。0で戦闘不能 | 800〜1200 |
| ATK | 攻撃力。武器ダメージの基礎 | 80〜120 |
| DEF | 防御力。被ダメージ軽減 | 30〜60 |
| Shield | シールド値。HPより先に消費 | 300〜500 |
| SPD | 移動速度(px/s) | 140〜180 |
| CritRate | 会心率(%) | 5〜10 |
| CritDmg | 会心ダメージ倍率(%) | 150 |

### 2-4. キャラタイプ詳細

| タイプ | 役割 | 特徴 |
|--------|------|------|
| **火力** | メインアタッカー | ATK補正+15%、ブレイク力低め |
| **補助** | バッファー/デバッファー | スキルで味方強化・敵弱体化 |
| **防御** | タンク | DEF/Shield補正+20%、味方へのダメージ軽減 |
| **医療** | ヒーラー | HP回復/シールド回復スキル持ち |
| **強襲** | ブレイカー | 気絶ダメージ+30%、ボスのブレイクゲージを効率的に削る |

---

## 3. バトルシステム

### 3-1. 基本操作

| 操作 | PC | モバイル |
|------|-----|---------|
| 移動 | WASD / 矢印キー | 仮想ジョイスティック(左) |
| 射撃 | 自動（常時） | 自動（常時） |
| スキル1 | Qキー | スキルボタン1(右) |
| スキル2 | Eキー | スキルボタン2(右) |
| 必殺技 | Rキー | 必殺ボタン(右) |
| 緊急回避 | Spaceキー | 回避ボタン(右) |
| キャラ切替 | 1/2/3キー | キャラアイコンタップ |

**射撃はオートエイム。最も近い敵を自動ターゲット。**

### 3-2. 耐久システム（二重ゲージ）

```
[========シールドゲージ========] ← チーム共有、先に消費
[==HP:レイナ==][==HP:セレナ==][==HP:カイラ==] ← 個別HP

ダメージ処理:
1. シールドが残っている → シールドから減算
2. シールド0 → 各キャラのHPから減算（操作中キャラ優先）
3. キャラHP0 → そのキャラ戦闘不能（残りメンバーで継続）
4. 全員HP0 → ミッション失敗
```

シールドは時間経過で自然回復しない。医療タイプのスキルまたはアイテムで回復。

### 3-3. ブレイクシステム

ボス敵にはブレイクゲージ（気絶ゲージ）が存在する。

```
[==========ブレイクゲージ==========]

- 攻撃でゲージを削る
- 強襲タイプはブレイク効率+30%
- ゲージが0になるとボスが「ブレイク状態」（5秒間）
  → 行動停止、被ダメージ+50%
- ブレイク終了後ゲージ全回復
```

### 3-4. 属性相性

```
生体(赤) ──強い──→ 霊脳(緑) ──強い──→ 機械(青) ──強い──→ 生体(赤)
              ↑                                      │
              └──────────── 弱い ──────────────────────┘

侵蝕(紫) ←──相互弱点──→ 防疫(黄)
```

| 関係 | ダメージ倍率 |
|------|------------|
| 有利属性 | ×1.3 |
| 不利属性 | ×0.7 |
| 同属性/無関係 | ×1.0 |

### 3-5. スキルシステム

各キャラカードは以下のスキルを持つ:

| スキル種 | 説明 | クールダウン |
|---------|------|-----------|
| **通常攻撃** | 武器種に応じた自動射撃 | なし |
| **スキル1（AS1）** | アクティブスキル小 | 8〜12秒 |
| **スキル2（AS2）** | アクティブスキル大 | 15〜20秒 |
| **必殺技（ULT）** | 超強力な攻撃/回復。専用ゲージが満タンで使用可 | ULTゲージ依存 |
| **パッシブ** | 常時発動。条件付きバフなど | - |

ULTゲージは攻撃命中・被ダメージ・時間経過で蓄積。

### 3-6. 武器種別の射撃特性

| 武器種 | 射程 | 射速 | 弾数/リロード | 特徴 |
|--------|------|------|-------------|------|
| **ピストル** | 中 | 速い(5発/s) | 12発/1.2秒 | バランス型、精度良好 |
| **アサルトライフル** | 中〜長 | 速い(6発/s) | 30発/1.8秒 | 連射型、やや拡散 |
| **ショットガン** | 短 | 遅い(1.2発/s) | 6発/2秒 | 近距離扇状、高瞬間火力 |
| **スナイパーライフル** | 長 | 非常に遅い(0.8発/s) | 5発/2.5秒 | 高ダメージ、貫通 |
| **ランチャー** | 中 | 遅い(0.6発/s) | 3発/3秒 | 爆発範囲攻撃、自傷なし |

### 3-7. 状態異常

| 状態異常 | 効果 | 持続時間 |
|---------|------|---------|
| **燃焼** | 毎秒ATK×5%のダメージ | 5秒 |
| **凍結** | 移動速度-50% | 3秒 |
| **感電** | 攻撃速度-30% | 4秒 |
| **腐食** | DEF-20% | 6秒 |
| **浄化** | 被ダメージ+15% | 5秒 |

---

## 4. 装備・強化システム

### 4-1. 武器

#### 武器の基本属性

| 属性 | 説明 |
|------|------|
| **メイン属性（ATK）** | 装備キャラのATKに加算 |
| **サブ属性:ダメージ** | 通常攻撃＋スキルの与ダメージ%上昇 |
| **サブ属性:会心** | 会心率%上昇 |
| **サブ属性:射速** | 攻撃速度%上昇 |
| **サブ属性:気絶** | ブレイクダメージ上昇 |
| **武器スキル** | 武器固有の効果（確率で追加ダメージ等） |

#### 武器レアリティ

| レアリティ | サブ属性数 | 入手方法 |
|----------|----------|---------|
| ★1 | 0 | ステージドロップ |
| ★2 | 1 | ステージドロップ |
| ★3 | 2 | 上級ステージ、ショップ |
| ★4 | 3 | ボスドロップ（低確率）、イベント報酬 |

#### 武器強化

| 強化方法 | 必要素材 | 効果 |
|---------|---------|------|
| **レベルアップ** | 強化素材＋クレジット | メイン属性(ATK)上昇 |
| **限界突破** | 同武器 or 突破素材＋クレジット | Lv上限解放(+10ずつ) |
| **改造（部品）** | 部品×最大4個 | 特性＋サブ属性追加 |

#### 武器改造（部品システム）

武器に最大4つの部品をセットして強化する。

```
武器スロット:
├─ [部品1: バレル]   → 射程・精度に影響
├─ [部品2: マガジン] → 装弾数・リロードに影響
├─ [部品3: スコープ] → 会心・ダメージに影響
└─ [部品4: ストック] → 安定性・射速に影響
```

部品の品質:
- **通常品質（紫枠）**: サブ属性+1〜2個
- **高品質（金枠）**: サブ属性+2〜3個、特性付き

部品のサブ属性はランダムで付与。マイナス値もあり得る。
「再演算」でクレジットを消費してサブ属性の再抽選が可能。

### 4-2. モジュール

キャラに装備する補助装備。4種類×1個ずつ。

| モジュール種 | 主効果 | 付加属性（ランダム） |
|------------|--------|------------------|
| **ATKモジュール** | ATK上昇 | 会心率、会心ダメ、ダメージ% |
| **DEFモジュール** | DEF上昇 | 抵抗、被ダメ軽減% |
| **HPモジュール** | HP上昇 | HP回復量、状態異常耐性 |
| **Shieldモジュール** | Shield上昇 | シールド回復速度、ブレイク耐性 |

モジュールのレアリティ: N / R / SR / SSR
付加属性の数: N=0 / R=1 / SR=2 / SSR=3

**属性ボーナス**: モジュールの属性がキャラと一致すると効果+15%

モジュール強化:
- **レベルアップ**: 素材消費でモジュールLv上昇（最大30）
- **突破**: 突破素材でLv上限解放＋モジュール効果強化
- **再演算**: 付加属性をランダムで再抽選（旧/新を選択可）

### 4-3. キャラ強化

| 強化方法 | 素材 | 効果 |
|---------|------|------|
| **レベルアップ** | EXP素材＋クレジット | 全ステータス上昇。初期上限Lv40 |
| **限界突破** | 同キャラカード or 突破素材 | Lv上限+10（最大Lv80） |
| **覚醒** | 覚醒素材（レア） | スキル強化、パッシブ追加 |
| **シンクロ** | ステージクリアで自動蓄積 | スキルレベル上昇 |

### 4-4. サブキャラクターシステム

メイン編成キャラ1人につき、最大3人のサブキャラをセット可能。

```
メイン: レイナ(★3通常)
├─ サブ1: セレナ → ATK+5%
├─ サブ2: カイラ → DEF+3%
└─ サブ3: (空き)

※同属性のサブキャラをセットするとボーナス+5%追加
```

サブキャラはバトルに直接参加しないが、ステータスバフを提供。

---

## 5. ステージ・フィールド設計

### 5-1. ステージ構成

```
チャプター1: 都市廃墟（チュートリアル含む）
├─ 1-1: 偵察任務         [電力消費: 6]  ★推奨戦力: 500
├─ 1-2: 掃討作戦         [電力消費: 6]  ★推奨戦力: 600
├─ 1-3: 拠点確保         [電力消費: 6]  ★推奨戦力: 700
├─ ...
├─ 1-10: 調査任務        [電力消費: 8]
├─ 1-11: 潜入作戦        [電力消費: 8]
└─ 1-12: [BOSS] XR-07    [電力消費: 10] ★推奨戦力: 1200

チャプター2: 汚染森林
├─ 2-1〜2-12（同構造）
└─ 2-12: [BOSS] ニドホッグ

チャプター3: 地下研究所
├─ 3-1〜3-12
└─ 3-12: [BOSS] 魔神兵プロト
```

**MVP: チャプター1（12ステージ）のみ実装**

### 5-2. ステージ内の流れ

```
1. ステージ選択 → 編成確認 → 出撃（電力消費）
2. マップ上を移動（矢印ナビで索敵）
3. 敵グループとエンカウント → 戦闘
4. 全敵撃破 → 次のエリアへ移動
5. 2〜4回のウェーブ戦闘
6. 最終ウェーブ（ボスまたはエリートあり）
7. クリア → 評価（★1〜3）→ 報酬獲得
```

### 5-3. ステージ評価

| 条件 | 星 |
|------|-----|
| クリア | ★1 |
| 味方戦闘不能なし | ★2 |
| 制限時間内クリア | ★3 |

### 5-4. 電力（スタミナ）システム

| 項目 | 値 |
|------|-----|
| 最大電力 | 120 |
| 回復速度 | 5分に1回復 |
| 通常ステージ消費 | 6〜8 |
| ボスステージ消費 | 10〜12 |
| レベルアップ時 | 全回復 |

### 5-5. ドロップシステム

| ドロップ種 | 内容 |
|----------|------|
| **クレジット** | 汎用通貨（強化に使用） |
| **EXP素材** | キャラレベルアップ用 |
| **武器強化素材** | 武器レベルアップ用 |
| **武器** | ★1〜3がランダムドロップ |
| **モジュール** | 特定ステージで低確率 |
| **覚醒素材** | 上級ステージ限定 |
| **部品** | チャレンジステージ限定 |

---

## 6. UI画面構成

### 6-1. 画面遷移図

```
[タイトル画面]
    │
    ▼
[メインメニュー]
    ├─ [出撃] → [チャプター選択] → [ステージ選択] → [編成] → [シナリオ(あれば)] → [バトル] → [シナリオ(あれば)] → [リザルト]
    ├─ [編成] → キャラ一覧 → キャラ詳細（装備/スキル確認）
    ├─ [強化]
    │   ├─ キャラ強化（レベル/限界突破/覚醒）
    │   ├─ 武器強化（レベル/限界突破/改造）
    │   └─ モジュール（強化/再演算）
    ├─ [回想ギャラリー] → カテゴリ選択 → シナリオ再生
    ├─ [ショップ] → 素材購入、武器購入
    └─ [設定] → 音量、操作設定、スキップ設定
```

### 6-2. バトルHUD

```
┌──────────────────────────────────────────────┐
│ [ステージ名]              [残り時間] [PAUSE] │
│                                              │
│ [キャラ1アイコン] [キャラ2] [キャラ3]        │
│ [HP1] [HP2] [HP3]                            │
│ [========シールドゲージ========]              │
│                                              │
│                                              │
│              (バトルフィールド)               │
│                                              │
│                                              │
│   [ボスHP]                                   │
│   [ブレイクゲージ]                           │
│                                              │
│ [JOYSTICK]           [回避] [SK1] [SK2] [ULT]│
└──────────────────────────────────────────────┘
```

---

## 7. シナリオシステム

### 7-1. 概要

ノベルゲーム風の会話演出でストーリーを展開する。ステージ開始前（プレバトル）とクリア後（ポストバトル）にシナリオが自動再生され、キャラクターの掛け合いや世界観を伝える。

### 7-2. シナリオ再生の基本仕様

```
┌──────────────────────────────────────────────┐
│                                              │
│     [背景画像: 都市廃墟]                     │
│                                              │
│                                              │
│          [キャラ立ち絵: レイナ]              │
│          (表情: serious)                     │
│                                              │
│ ┌──────────────────────────────────────────┐ │
│ │ レイナ                                   │ │
│ │ ステラ部隊、レイナ・ヴォルト。           │ │
│ │ 現場に到着しました。                     │ │
│ └──────────────────────────────────────────┘ │
│                                              │
│            [▼] [SKIP] [AUTO] [LOG]           │
└──────────────────────────────────────────────┘
```

**表示要素:**
- **背景画像**: シーンに応じた背景（最大2枚重ね可能）
- **キャラ立ち絵**: 話者のスプライト（表情差分あり）
- **テキストウィンドウ**: 話者名＋セリフ。1クリックで次のセリフへ
- **操作ボタン**: ▼（次へ）、SKIP、AUTO、LOG

### 7-3. テキスト送り仕様

| 操作 | PC | モバイル | 動作 |
|------|-----|---------|------|
| 次のセリフ | クリック / Enter / Space | タップ | テキスト全表示 or 次のセリフへ |
| テキスト早送り | 同上（表示途中にクリック） | 同上 | 現在のセリフを即全表示 |
| AUTO | Aキー / ボタンクリック | ボタンタップ | 3秒ごとに自動送り（ON/OFF） |
| SKIP | Sキー / ボタンクリック | ボタンタップ | 高速スキップ（下記参照） |
| LOG | Lキー / ボタンクリック | ボタンタップ | バックログ表示 |

### 7-4. スキップ機能

2種類のスキップモードを実装:

| モード | 動作 | 用途 |
|--------|------|------|
| **全スキップ** | 未読・既読関係なくシナリオを全て飛ばしてバトルへ | 2周目以降、急いでいるとき |
| **既読スキップ** | 既読テキストのみ高速送り。未読テキストで一時停止 | 初見シーンだけ読みたいとき |

**スキップ実装詳細:**
- スキップ中はテキスト表示をスキップし、背景・BGM遷移のみ即座に実行
- スキップ速度: 1セリフあたり50ms（通常表示の約60倍速）
- 既読判定: `localStorage`に`scenarioId + seqNo`をセットとして保存
- スキップ完了後、直接バトルシーンに遷移

```javascript
// 既読管理の構造
saveData.readScenarios = {
    "scenario_1_1": [1, 2, 3, 4, 5, 6, 7],  // 既読seqNoの配列
    "scenario_1_2": [1, 2, 3, 4, 5]
};
```

### 7-5. バックログ機能

| 項目 | 仕様 |
|------|------|
| 表示内容 | 話者名＋セリフの履歴（現在のシナリオ内のみ） |
| 最大保持数 | 100件 |
| 操作 | スクロールで過去のセリフを確認 |
| 閉じ方 | CLOSEボタン or 画面外タップ |

### 7-6. 演出エフェクト

シナリオデータの`effect`列で指定:

| エフェクト | 動作 | 用途 |
|-----------|------|------|
| `fade_in` | 画面が黒→明転（500ms） | シーン開始 |
| `fade_out` | 画面が明→暗転（500ms） | シーン終了、バトルへ遷移 |
| `screen_shake` | 画面が振動（300ms、強度3px） | 爆発、敵出現 |
| `flash` | 画面が白く光る（200ms） | 強い衝撃、覚醒 |

### 7-7. シナリオ再生タイミング

```
ステージ選択 → 編成確認 → 出撃
    │
    ▼
[プレバトルシナリオ] ← scenarioIdがstagesシートに指定されている場合のみ
    │ (SKIP可能)
    ▼
[バトル]
    │
    ▼
[ポストバトルシナリオ] ← ボスステージなど特定ステージのみ（scenarioId末尾に_postを付加）
    │ (SKIP可能)
    ▼
[リザルト画面]
```

**注意**: scenarioIdが空のステージではシナリオをスキップし、直接バトルに遷移。

### 7-8. 回想ギャラリー（シナリオ回想）

メインメニューからアクセスできるギャラリー画面で、過去に閲覧したシナリオを再生可能。

```
┌──────────────────────────────────────────────┐
│ ◀ 回想ギャラリー                             │
│                                              │
│ ┌─────────┐ ┌─────────┐ ┌─────────┐        │
│ │ [thumb]  │ │ [thumb]  │ │  🔒     │        │
│ │ EP.1     │ │ EP.2     │ │  ???    │        │
│ │ 出撃、   │ │ 掃討の   │ │         │        │
│ │ ステラ部隊│ │ 決意     │ │         │        │
│ └─────────┘ └─────────┘ └─────────┘        │
│                                              │
│ [メインストーリー] [キャラストーリー] [イベント]│
│                                              │
│ ◀ 1 / 3 ▶                                   │
└──────────────────────────────────────────────┘
```

**ギャラリー仕様:**

| 項目 | 仕様 |
|------|------|
| **アンロック条件** | 該当ステージをクリア済み（`unlockCondition`で判定） |
| **ロック表示** | サムネイルの代わりに🔒アイコン、タイトルは「???」 |
| **カテゴリタブ** | メインストーリー / キャラストーリー / イベント |
| **ソート** | `sortOrder`順（ストーリー時系列） |
| **再生** | タップでシナリオ再生開始（スキップ/AUTO/LOG使用可） |
| **サムネイル** | シナリオの印象的な場面のスクリーンショット（128×96px） |

**保存データ:**
```javascript
saveData.gallery = {
    unlockedIds: ["gal_01", "gal_02", "gal_03"],  // アンロック済みギャラリーID
};
```

### 7-9. シナリオデータ構造

scenariosシート（Excelマスターデータ）→ `scenarios.json` としてエクスポート:

```json
[
  {
    "scenarioId": "scenario_1_1",
    "seqNo": 1,
    "speaker": "",
    "speakerSpriteKey": "",
    "expression": "",
    "text": "――都市廃墟、作戦開始地点。",
    "bgKey": "bg_city_ruin",
    "bgmKey": "bgm_briefing",
    "sfxKey": "",
    "choiceFlag": "",
    "effect": "fade_in"
  },
  {
    "scenarioId": "scenario_1_1",
    "seqNo": 2,
    "speaker": "レイナ",
    "speakerSpriteKey": "chr_01_normal",
    "expression": "confident",
    "text": "ステラ部隊、レイナ・ヴォルト。現場に到着しました。",
    "bgKey": "",
    "bgmKey": "",
    "sfxKey": "",
    "choiceFlag": "",
    "effect": ""
  }
]
```

**データ仕様:**
- `scenarioId`: ステージのscenarioIdに対応
- `seqNo`: 同一シナリオ内の表示順（1始まり）
- `speaker`: 空の場合はナレーション（テキストウィンドウの名前欄を非表示）
- `speakerSpriteKey`: 立ち絵のスプライトキー。空なら立ち絵なし
- `expression`: 表情差分のキー（calm, serious, battle等）
- `bgKey`: 背景変更。空なら現在の背景を維持
- `bgmKey`: BGM変更。空なら現在のBGMを維持
- `sfxKey`: SE再生。空ならSEなし
- `choiceFlag`: 将来拡張用（選択肢分岐）
- `effect`: 演出エフェクト

### 7-10. シナリオ用追加アセット

| キー | サイズ | 説明 |
|------|--------|------|
| **キャラ立ち絵** | | |
| chr_01_portrait | 256×512px | レイナ立ち絵（表情差分: calm, serious, battle, confident, surprised） |
| chr_02_portrait | 256×512px | セレナ立ち絵（表情差分: calm, worried, focused） |
| chr_03_portrait | 256×512px | カイラ立ち絵（表情差分: excited, confident, worried, exhausted, amazed） |
| chr_04_portrait | 256×512px | ノワール立ち絵（表情差分: cool, cold） |
| chr_05_portrait | 256×512px | リリス立ち絵（表情差分: cheerful, wink） |
| chr_06_portrait | 256×512px | ミラ立ち絵（表情差分: focused, cold） |
| **背景** | | |
| bg_city_ruin | 800×600px | 都市廃墟（明るめ） |
| bg_city_ruin_deep | 800×600px | 都市廃墟（深部、暗め） |
| bg_city_lab | 800×600px | 旧研究所内部 |
| **UI** | | |
| ui_textwindow | 760×160px | テキストウィンドウ背景（半透明黒） |
| ui_btn_skip | 80×32px | SKIPボタン |
| ui_btn_auto | 80×32px | AUTOボタン |
| ui_btn_log | 80×32px | LOGボタン |
| ui_gallery_lock | 128×96px | ギャラリーのロック表示用 |
| **サムネイル** | | |
| thumb_1_1〜thumb_1_12 | 128×96px | 各シナリオのサムネイル画像 |

---

## 8. データ構造

### 8-1. characters.json

```json
[
  {
    "id": "chr_01_normal",
    "charId": "chr_01",
    "name": "レイナ・ヴォルト",
    "cardName": "通常・レイナ",
    "rarity": 3,
    "attribute": "bio",
    "type": "dps",
    "weaponType": "assault_rifle",
    "baseStats": {
      "hp": 1000,
      "atk": 110,
      "def": 40,
      "shield": 400,
      "spd": 160,
      "critRate": 8,
      "critDmg": 150
    },
    "growthPerLevel": {
      "hp": 25,
      "atk": 3,
      "def": 1,
      "shield": 10
    },
    "skills": {
      "skill1": {
        "name": "バーストショット",
        "description": "前方に高速3連射。ATK×180%ダメージ",
        "cooldown": 10,
        "damageMultiplier": 1.8
      },
      "skill2": {
        "name": "サプレッション",
        "description": "広範囲に制圧射撃。ATK×120%×5発。敵移動速度-30%(3秒)",
        "cooldown": 18,
        "damageMultiplier": 1.2,
        "hits": 5
      },
      "ultimate": {
        "name": "ヴォルテックスバレット",
        "description": "全方位に弾幕を展開。ATK×300%ダメージ（範囲）",
        "damageMultiplier": 3.0
      },
      "passive": {
        "name": "クイックリロード",
        "description": "リロード時間-20%"
      }
    },
    "spriteKey": "chr_01_normal"
  }
]
```

### 8-2. weapons.json

```json
[
  {
    "id": "wpn_ar_001",
    "name": "M-7 スタンダード",
    "weaponType": "assault_rifle",
    "rarity": 2,
    "mainAtk": 50,
    "subAttributes": {
      "damage": 5.0,
      "critRate": 0,
      "fireRate": 0,
      "stagger": 0
    },
    "weaponSkill": {
      "name": "連射強化",
      "description": "10発命中ごとに次の攻撃のダメージ+20%",
      "trigger": "hit_count",
      "triggerValue": 10,
      "effect": "damage_buff",
      "effectValue": 0.2
    },
    "maxLevel": 40,
    "spriteKey": "wpn_ar_001"
  }
]
```

### 8-3. modules.json

```json
[
  {
    "id": "mod_atk_001",
    "name": "ATKモジュールα",
    "moduleType": "atk",
    "rarity": "SR",
    "attribute": "bio",
    "mainValue": 30,
    "subAttributes": [
      { "type": "critRate", "value": 3.5 },
      { "type": "critDmg", "value": 8.0 }
    ],
    "maxLevel": 30
  }
]
```

### 8-4. enemies.json

```json
[
  {
    "id": "enemy_drone_01",
    "name": "偵察ドローン",
    "attribute": "machine",
    "hp": 200,
    "atk": 15,
    "def": 5,
    "spd": 100,
    "attackPattern": "chase_shoot",
    "bulletSpeed": 200,
    "fireRate": 1.5,
    "xpReward": 10,
    "creditReward": 5,
    "spriteKey": "enemy_drone_01"
  },
  {
    "id": "boss_xr07",
    "name": "XR-07",
    "attribute": "machine",
    "hp": 15000,
    "atk": 80,
    "def": 30,
    "spd": 60,
    "breakGauge": 1000,
    "attackPatterns": [
      {
        "phase": 1,
        "hpThreshold": 1.0,
        "patterns": ["spread_shot", "laser_sweep", "summon_drones"]
      },
      {
        "phase": 2,
        "hpThreshold": 0.5,
        "patterns": ["barrage", "laser_cross", "charge_attack"]
      }
    ],
    "spriteKey": "boss_xr07"
  }
]
```

### 8-5. stages.json

```json
[
  {
    "id": "stage_1_1",
    "chapter": 1,
    "stageNum": 1,
    "name": "偵察任務",
    "description": "都市廃墟の偵察。敵の動向を探れ。",
    "staminaCost": 6,
    "recommendedPower": 500,
    "recommendedAttribute": "bio",
    "timeLimit": 180,
    "waves": [
      {
        "enemies": [
          { "id": "enemy_drone_01", "count": 5, "spawnDelay": 500 }
        ]
      },
      {
        "enemies": [
          { "id": "enemy_drone_01", "count": 3 },
          { "id": "enemy_soldier_01", "count": 2, "spawnDelay": 1000 }
        ]
      }
    ],
    "drops": [
      { "type": "credit", "min": 50, "max": 100 },
      { "type": "exp_material", "id": "exp_s", "chance": 0.5 },
      { "type": "weapon", "rarity": 1, "chance": 0.1 }
    ],
    "firstClearReward": {
      "gems": 30,
      "exp_material": [{ "id": "exp_m", "count": 2 }]
    },
    "scenarioId": "scenario_1_1"
  }
]
```

### 8-6. scenarios.json

```json
[
  {
    "scenarioId": "scenario_1_1",
    "seqNo": 1,
    "speaker": "",
    "speakerSpriteKey": "",
    "expression": "",
    "text": "――都市廃墟、作戦開始地点。",
    "bgKey": "bg_city_ruin",
    "bgmKey": "bgm_briefing",
    "sfxKey": "",
    "choiceFlag": "",
    "effect": "fade_in"
  },
  {
    "scenarioId": "scenario_1_1",
    "seqNo": 2,
    "speaker": "レイナ",
    "speakerSpriteKey": "chr_01_normal",
    "expression": "confident",
    "text": "ステラ部隊、レイナ・ヴォルト。現場に到着しました。",
    "bgKey": "",
    "bgmKey": "",
    "sfxKey": "",
    "choiceFlag": "",
    "effect": ""
  }
]
```

### 8-7. scenario_gallery.json

```json
[
  {
    "galleryId": "gal_01",
    "scenarioId": "scenario_1_1",
    "title": "出撃、ステラ部隊",
    "chapter": 1,
    "unlockCondition": "stage_1_1_clear",
    "thumbnailKey": "thumb_1_1",
    "category": "main_story",
    "sortOrder": 1,
    "description": "初めてのミッション。レイナ、セレナ、カイラの3人が出撃する。"
  }
]
```

---

## 9. 実装優先順位

### Phase 1: MVP（必須 — 4〜6週間）
1. プロジェクト構造・基本シーン（タイトル/メニュー/バトル/リザルト）
2. プレイヤー3人パーティの移動（WASD/仮想ジョイスティック）
3. オートエイム射撃（武器種ごとの弾道）
4. 敵のスポーン・AI（追尾射撃）
5. シールド＋HPの二重耐久システム
6. スキル発動（AS1/AS2のみ）
7. 属性相性ダメージ計算
8. ステージクリア→リザルト→報酬
9. チャプター1（12ステージ）のウェーブデータ
10. ボス戦（XR-07）：ブレイクゲージ、フェーズ切替

### Phase 2: 装備・強化（3〜4週間）
11. 武器装備＋メイン/サブ属性反映
12. 武器レベルアップ・限界突破
13. モジュール装備＋属性ボーナス
14. キャラレベルアップ・限界突破
15. サブキャラスロット
16. ショップ（素材・武器購入）
17. localStorage保存/読み込み
18. シナリオ再生システム（テキスト送り、立ち絵表示、背景切替）
19. スキップ機能（全スキップ＋既読スキップ）
20. バックログ機能

### Phase 3: ポリッシュ（2〜3週間）
21. 武器改造（部品システム）
22. モジュール再演算
23. 覚醒・シンクロ
24. 必殺技（ULT）実装
25. 緊急回避（i-frame付き）
26. 状態異常エフェクト
27. タッチ操作最適化
28. BGM・SE実装
29. 回想ギャラリー（シナリオ再生、アンロック管理）

### Phase 4: 拡張コンテンツ
30. チャプター2〜3
31. 追加キャラカード
32. チャレンジステージ（部品ドロップ用）
33. デイリーミッション
34. パーティクルエフェクト強化
35. キャラストーリー（個別シナリオ）

---

## 10. アセット一覧（MVP）

### キャラクタースプライト

| キー | サイズ | フレーム | 説明 |
|------|--------|---------|------|
| chr_01_normal | 48×48px | 歩行4方向×4F、攻撃4F、被弾2F、回避4F | レイナ：銀髪ショート、赤ジャケット |
| chr_02_normal | 48×48px | 同上 | セレナ：緑髪ロング、白衣 |
| chr_03_normal | 48×48px | 同上 | カイラ：青髪ポニテ、ゴーグル |
| chr_04_normal | 48×48px | 同上 | ノワール：黒髪ロング、ダークコート |
| chr_05_normal | 48×48px | 同上 | リリス：金髪ツインテ、軍服 |
| chr_06_normal | 48×48px | 同上 | ミラ：水色ボブ、ラボコート |

### 敵スプライト

| キー | サイズ | フレーム | 説明 |
|------|--------|---------|------|
| enemy_drone_01 | 32×32px | 移動2F、攻撃2F | 小型飛行ドローン（青白い機械体） |
| enemy_soldier_01 | 32×48px | 歩行4F、攻撃2F | 人型結晶兵（紫色の結晶化した人型） |
| enemy_tank_01 | 48×48px | 移動2F、攻撃2F | 重装甲ユニット |
| enemy_sniper_01 | 32×48px | 待機2F、攻撃2F | 遠距離狙撃型 |
| boss_xr07 | 128×128px | 待機4F、攻撃1:4F、攻撃2:4F、ブレイク2F | 大型機械ボス |

### 弾丸・エフェクト

| キー | サイズ | 説明 |
|------|--------|------|
| bullet_player | 8×8px | プレイヤー弾（黄色） |
| bullet_enemy | 8×8px | 敵弾（赤） |
| bullet_boss | 12×12px | ボス弾（紫） |
| fx_explosion | 32×32px 8F | 爆発エフェクト |
| fx_hit | 16×16px 4F | ヒットエフェクト |
| fx_shield | 48×48px 4F | シールドヒットエフェクト |

### UI要素

| キー | サイズ | 説明 |
|------|--------|------|
| ui_hp_bar | 100×12px | HPバー |
| ui_shield_bar | 200×16px | シールドバー |
| ui_break_bar | 150×10px | ブレイクゲージ |
| ui_skill_btn | 64×64px | スキルボタン |
| ui_joystick_base | 128×128px | ジョイスティック土台 |
| ui_joystick_thumb | 64×64px | ジョイスティックつまみ |

### 背景タイル

| キー | サイズ | 説明 |
|------|--------|------|
| tile_city_floor | 32×32px | 都市廃墟の床 |
| tile_city_wall | 32×32px | 壁・障害物 |
| tile_city_debris | 32×32px | 瓦礫 |
| bg_city | 800×600px | 都市廃墟背景 |

### シナリオ用 立ち絵

| キー | サイズ | 表情差分 | 説明 |
|------|--------|---------|------|
| chr_01_portrait | 256×512px | calm, serious, battle, confident, surprised | レイナ立ち絵 |
| chr_02_portrait | 256×512px | calm, worried, focused | セレナ立ち絵 |
| chr_03_portrait | 256×512px | excited, confident, worried, exhausted, amazed | カイラ立ち絵 |
| chr_04_portrait | 256×512px | cool, cold | ノワール立ち絵 |
| chr_05_portrait | 256×512px | cheerful, wink | リリス立ち絵 |
| chr_06_portrait | 256×512px | focused, cold | ミラ立ち絵 |

### シナリオ用 背景・UI

| キー | サイズ | 説明 |
|------|--------|------|
| bg_city_ruin | 800×600px | 都市廃墟（明るめ） |
| bg_city_ruin_deep | 800×600px | 都市廃墟（深部、暗め） |
| bg_city_lab | 800×600px | 旧研究所内部 |
| ui_textwindow | 760×160px | テキストウィンドウ背景（半透明黒） |
| ui_btn_skip | 80×32px | SKIPボタン |
| ui_btn_auto | 80×32px | AUTOボタン |
| ui_btn_log | 80×32px | LOGボタン |
| ui_gallery_lock | 128×96px | ギャラリーロック表示 |
| thumb_1_1〜1_12 | 128×96px | 各シナリオのサムネイル画像 |

---

## 11. 技術的制約・注意事項

### パフォーマンス
- 同時敵数: 最大30体で60fps維持
- 同時弾数: 最大200発（オブジェクトプール必須）
- 画面外の敵: 処理スキップ
- スプライトシート: 2048×2048px以下

### 保存データ
- localStorage使用
- キー: `stellar_gunners_save`
- 保存タイミング: ステージクリア時、強化完了時、メニュー遷移時
- 保存内容: キャラ所持/レベル、武器所持/レベル、モジュール、ストーリー進行、リソース量

### モバイル対応
- 仮想ジョイスティック（RexRainbowプラグイン推奨）
- スケール: `Phaser.Scale.FIT`
- 最小タッチターゲット: 44×44px
- ブラウザ自動再生対策: 初回タッチで AudioContext resume

### Phaser設定

```javascript
const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    parent: 'game-container',
    backgroundColor: '#1a1a2e',
    physics: {
        default: 'arcade',
        arcade: {
            debug: false // 開発時はtrue
        }
    },
    scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH
    },
    input: {
        activePointers: 3
    },
    scene: [BootScene, PreloadScene, TitleScene, MenuScene, FormationScene, ScenarioScene, GameScene, UIScene, ResultScene, GalleryScene]
};
```
